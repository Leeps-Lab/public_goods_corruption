{{ extends "global/Page.html" }}

{{ block content }}
<script>
    function displayTextFuncionario() {
  var text = document.getElementById("textFieldFuncionario");
  text.style.display = "block";
}
    function displayTextCiudadano() {
  var text = document.getElementById("textFieldCiudadano");
  text.style.display = "block";
}
</script>
<style>
    /* Split the screen in half */
.split {
  height: 100%;
  width: 50%;
  position: fixed;
  z-index: 1;
  top: 0;
  overflow-x: auto;
  padding-top: 20px;
}

/* Control the left side */
.left {
  left: 0;
  border-right:1px solid black;
}

/* Control the right side */
.right {
  right: 0;
 
  border-left:1px solid black;
}

/* If you want the content centered horizontally and vertically */
.centered {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

/* Style the image inside the centered container, if needed */
.centered img {
  width: 150px;
  border-radius: 50%;
}
</style>
<div class="split left">
    <div class="centered">
        <div id="decide" style="display: none">
        <p>
            Tu rol es {{ player.role }}.
        </p>
        
        <p>
            Tienes 500 para distribuir entre tu cuenta y un proyecto común.
        </p>
        <p>
            Puntos a dar:
        </p>
        <input type="number" id="my_offer">
        <button type="button" onclick="sendOffer()" id="btn-offer">Enviar puntos</button>
    </div>

    <div id="wait" style="display: none">
        <p>
            Esperando a que los otros ciudadanos respondan...
        </p>
        <progress></progress>
    </div>    

    <div id="results" style="display: none;">
        <p>
        Contribuiste <span id="my-proposal"></span>.
        </p>
        <p>
        Todos los ciudadanos contribuyeron <span id="sum_montos"></span> puntos, los que se convirtieron en --- puntos. 
        </p>
        <p>
        La autoridad te distribuyó a ti -- puntos. 
        </p>
        <p>
        Tu pago de la ronda es de --- puntos. 
        </p>

    </div>
    <br><br>

</div>

</div>

<div class="split right">

<table>
<tr>
{% for config in player.chat_configs %}
<th>
    <h6>{{ config.label }}</h6>
    {% chat nickname=player.chat_nickname channel=config.channel %}
</th>
{% endfor %}
</tr>
</table>
<br><br>
<table>
    <tr>
        <th>
            <button type="button" onclick="sendOfferOther1()" id="btn_offer1">Enviar puntos</button><input type="number" id="offer_other1">
        </th>
        <th>
            <button type="button" onclick="sendOfferOther2()" id="btn_offer2">Enviar puntos</button><input type="number" id="offer_other2">
        </th>
        <th>
            <button type="button" onclick="sendOfferOther3()" id="btn_offer3">Enviar puntos</button><input type="number" id="offer_other3">
        </th>
    </tr>
    <tr>
        <th>
            <button type="button" onclick="sendRequestOther1()" id="btn_request1">Solicitar puntos</button><input type="number" id="request_other1">
        </th>
        <th>
            <button type="button" onclick="sendRequestOther2()" id="btn_request2">Solicitar puntos</button><input type="number" id="request_other2">
        </th>
        <th>
            <button type="button" onclick="sendRequestOther3()" id="btn_request3">Solicitar puntos</button><input type="number" id="request_other3">
        </th>
    </tr>
    
    
</table>

</div>


<style>
    .otree-chat{
        width: 250px
    }
    .otree-chat__messages {
        height: 300px;
        width: 230px
    }
    .otree-chat__input {
        width: 230px
    }

</style>

    <script>
    let waitDiv = document.getElementById('wait');
    let decideDiv = document.getElementById('decide');
    let resultsDiv = document.getElementById('results');
    let my_offer= document.getElementById('my_offer');
    let msgMyProposal = document.getElementById('my-proposal');
    let sum_montos = 0;
    let msgSumMontos = document.getElementById('sum_montos');
    let btn_offer1 = document.getElementById('btn_offer1');
    let btn_offer2 = document.getElementById('btn_offer2');
    let btn_offer3 = document.getElementById('btn_offer3');
    let btn_request1 = document.getElementById('btn_request1');
    let btn_request2 = document.getElementById('btn_request2');
    let btn_request3 = document.getElementById('btn_request3');

    my_offer.addEventListener("keydown", function (event) {
        if (event.key === "Enter") {
            sendOffer();
        }
    });

    function sendOffer() {
        liveSend({ 'type':'bien_publico', 'monto': my_offer.value });
    }
    function sendOfferOther1() {
        liveSend({ 'type':'offer', 'monto_offer1': offer_other1.value,  });
        btn_offer1.disabled = true;
    }
    function sendOfferOther2() {
        liveSend({ 'type':'offer', 'monto_offer2': offer_other2.value });
        btn_offer2.disabled = true;
    }
    function sendOfferOther3() {
        liveSend({ 'type':'offer', 'monto_offer3': offer_other3.value });
        btn_offer3.disabled = true;
    }
    function sendRequestOther1() {
        liveSend({ 'type':'request', 'monto_request1': request_other1.value,  });
        btn_request1.disabled = true;
    }
    function sendRequestOther2() {
        liveSend({ 'type':'request', 'monto_request2': request_other1.value,  });
        btn_request2.disabled = true;
    }
    function sendRequestOther3() {
        liveSend({ 'type':'request', 'monto_request3': request_other1.value,  });
        btn_request3.disabled = true;
    }
    function show(ele) {
        for (let div of [waitDiv, decideDiv, resultsDiv]) {
            div.style.display = (div === ele) ? 'block' : 'none';
        }
    }

    function cu(monto) {
        return `${monto} puntos`;
    }

    function liveRecv(data) {
        console.log('received a message!', data);
        
        if ('proposals' in data){
            sum_montos = 0
            for (let [id_in_group, proposal] of data.proposals){
                if (id_in_group === js_vars.my_id){

                msgMyProposal.innerHTML = cu(proposal)
                console.log(proposal)
                } else {
                    sum_montos = sum_montos + proposal
                }
                }
            }
        msgSumMontos.innerHTML = sum_montos
        
        let is_waiting = data.should_wait;
        let is_results = data.show_results;
        if (is_waiting) {
            show(waitDiv)
            } else if (is_results) {
            show(resultsDiv)
            } else {
                show(decideDiv)
            }
        
        }
        
    window.addEventListener('DOMContentLoaded', (event) => {
        liveSend({'type':'load'});
    });


    </script>

    

{{ endblock }}
